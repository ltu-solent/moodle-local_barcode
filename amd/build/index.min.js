define(["jquery","core/str"],function(a,b){function c(){a("#id_barcode").focus(),document.getElementById("id_barcode").addEventListener("keypress",g,!1),document.getElementById("id_submitbutton").addEventListener("click",h,!1);var c=b.get_strings([{key:"assignmentdetails",component:"local_barcode"},{key:"barcodes",component:"local_barcode"},{key:"draft",component:"local_barcode"},{key:"draftandsubmissionerror",component:"local_barcode"},{key:"due",component:"local_barcode"},{key:"notsubmitted",component:"local_barcode"},{key:"scanned",component:"local_barcode"},{key:"student",component:"local_barcode"},{key:"submitted",component:"local_barcode"}]);a.when(c).done(function(a){M=a,l()})}function d(b){b.stopPropagation(),b.preventDefault();var c=e();return c&&!i()&&(a("#feedback").html(M[3]),a("#feedback-group").addClass("bc-has-inform"),a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-success")),c&&i()&&j(c),a("#id_barcode").focus(),!1}function e(){return document.getElementById("id_barcode").value.trim()}function f(){a("#id_barcode").val("")}function g(a){var b=a.which||a.keyCode;return 13===b&&(a.stopPropagation(),a.preventDefault(),q(),s(),d(a)),!1}function h(a){return a.stopPropagation(),a.preventDefault(),q(),s(),d(a),!1}function i(){return"0"===J||"0"===K}function j(b){var c="service/upload.php?barcode=";w&&(c="../service/upload.php?barcode="),a.ajax({type:"POST",url:c+b+"&id="+v+"&revert="+J+"&ontime="+K,data:{barcode:b},success:function(a){"undefined"!=typeof a.faultCode?(x=a.faultString,F=a.faultString):(x=a.data.code,F=a.data.message,G=a.data.assignment,H=a.data.assignmentdescription,y=a.data.course,z=a.data.duedate,A=a.data.idformat,B=a.data.studentid,C=a.data.studentname,D=a.data.submissiontime,E=a.data.islate,L=a.data.reverted,u()||(r(),t())),k()},error:function(a){},dataType:"json"})}function k(){var b=a("#feedback");b.html(F),200===x&&(p(),L?(I=M[2],a("#feedback-group").addClass("bc-has-success"),a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-inform"),m("revert")):(I=M[8],a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-inform"),a("#feedback-group").addClass("bc-has-success"),m("success"))),404===x&&(G="-"),200!==x&&(I=M[6],a("#feedback-group").removeClass("bc-has-success"),a("#feedback-group").removeClass("bc-has-inform"),a("#feedback-group").addClass("bc-has-danger"),m("fail")),f(),o()}function l(){var b=a("#region-main"),c=a("<table></table>");c.attr("id","barcode-table"),c.addClass("generaltable"),c.addClass("barcode-table");var d=c.append("<thead></thead>"),e=d.append("<tr></tr>");e.html('<th colspan="8">'+M[1]+' - (<span id="id_count">0</span> '+M[6]+')</th><th colspan="17">'+M[0]+'</th><th colspan="5">'+M[8]+'(<span id="submit_count">0</span>)</th>'),c.append('<tbody id="tbody"></tbody>'),b.append(c)}function m(b){for(var c="bc-"+b,d=[8,17,5],e=n(),f=a("#tbody"),g=a("<tr></tr>"),h=0;h<=2;h++){var i=a("<td></td>"),j=a("<span></span>");i.attr("colspan",d[h]),j.html(e[h]),i.append(j),2===h&&(j.addClass("visuallyhidden"),i.addClass(c)),g.append(i)}f.prepend(g)}function n(){var a="bc-ontime";return E&&(a="bc-islate"),[e(),G+"<br /><small>"+H.substring(0,30)+"</small><br /><small>"+y+"</small><br /><small>"+M[7]+": "+C+" / "+A+": "+B+"</small><br /><small>"+M[4]+": "+z+"&nbsp; "+M[6]+': <span class="'+a+'">'+D+"</span></small><br />",I]}function o(){return a("#id_count").html(N()),!1}function p(){return a("#submit_count").html(O()),!1}function q(){J=document.getElementById("id_reverttodraft").checked===!0?"1":"0"}function r(){document.getElementById("id_reverttodraft").checked=!1}function s(){K=document.getElementById("id_submitontime")&&document.getElementById("id_submitontime").checked===!0?"1":"0"}function t(){document.getElementById("id_submitontime").checked=!1}function u(){return document.getElementById("id_multiplescans").checked}var v,w,x,y,z,A,B,C,D,E,F="",G="-",H="",I="Not Submitted",J="0",K="0",L=0,M=[],N=function(){function a(){b+=1}var b=0;return function(){return a(),b}}(),O=function(){function a(){b+=1}var b=0;return function(){return a(),b}}();return{init:function(a,b){c(),v=a,w=b}}});