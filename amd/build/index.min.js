define(["jquery","core/str"],function(a,b){function c(){a("#id_barcode").focus(),document.getElementById("id_barcode").addEventListener("keypress",g,!1),document.getElementById("id_submitbutton").addEventListener("click",h,!1);var c=b.get_strings([{key:"assignmentdetails",component:"local_barcode"},{key:"barcodes",component:"local_barcode"},{key:"draft",component:"local_barcode"},{key:"draftandsubmissionerror",component:"local_barcode"},{key:"due",component:"local_barcode"},{key:"notsubmitted",component:"local_barcode"},{key:"scanned",component:"local_barcode"},{key:"student",component:"local_barcode"},{key:"submitted",component:"local_barcode"}]);a.when(c).done(function(a){L=a,l()})}function d(b){b.stopPropagation(),b.preventDefault();var c=e();return c&&!i()&&(a("#feedback").html(L[3]),a("#feedback-group").addClass("bc-has-inform"),a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-success")),c&&i()&&j(c),a("#id_barcode").focus(),!1}function e(){return document.getElementById("id_barcode").value.trim()}function f(){a("#id_barcode").val("")}function g(a){var b=a.which||a.keyCode;return 13===b&&(a.stopPropagation(),a.preventDefault(),q(),s(),d(a)),!1}function h(a){return a.stopPropagation(),a.preventDefault(),q(),s(),d(a),!1}function i(){return"0"===I||"0"===J}function j(b){var c="service/upload.php?barcode=";v&&(c="../service/upload.php?barcode="),a.ajax({type:"POST",url:c+b+"&id="+u+"&revert="+I+"&ontime="+J,data:{barcode:b},success:function(a){"undefined"!=typeof a.faultCode?(w=a.faultString,E=a.faultString):(w=a.data.code,E=a.data.message,F=a.data.assignment,G=a.data.assignmentdescription,x=a.data.course,y=a.data.duedate,z=a.data.idformat,A=a.data.studentid,B=a.data.studentname,C=a.data.submissiontime,D=a.data.islate,K=a.data.reverted,r(),t()),k()},error:function(a){w=a.data.code,E=a.data.message,F=a.data.assignment,G=a.data.assignmentdescription,x=a.data.course,y=a.data.duedate,z=a.data.idformat,A=a.data.studentid,B=a.data.studentname,C=a.data.submissiontime,D=a.data.islate,K=a.data.reverted,k()},dataType:"json"})}function k(){var b=a("#feedback");b.html(E),200===w&&(p(),K?(H=L[2],a("#feedback-group").addClass("bc-has-success"),a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-inform"),m("revert")):(H=L[8],a("#feedback-group").removeClass("bc-has-danger"),a("#feedback-group").removeClass("bc-has-inform"),a("#feedback-group").addClass("bc-has-success"),m("success")),f()),404===w&&(F="-"),200!==w&&(H=L[6],a("#feedback-group").removeClass("bc-has-success"),a("#feedback-group").removeClass("bc-has-inform"),a("#feedback-group").addClass("bc-has-danger"),m("fail")),o()}function l(){var b=a("#region-main"),c=a("<table></table>");c.attr("id","barcode-table"),c.addClass("generaltable"),c.addClass("barcode-table");var d=c.append("<thead></thead>"),e=d.append("<tr></tr>");e.html('<th colspan="8">'+L[1]+' - (<span id="id_count">0</span> '+L[6]+')</th><th colspan="17">'+L[0]+'</th><th colspan="5">'+L[8]+'(<span id="submit_count">0</span>)</th>'),c.append('<tbody id="tbody"></tbody>'),b.append(c)}function m(b){for(var c="bc-"+b,d=[8,17,5],e=n(),f=a("#tbody"),g=a("<tr></tr>"),h=0;h<=2;h++){var i=a("<td></td>"),j=a("<span></span>");i.attr("colspan",d[h]),j.html(e[h]),i.append(j),2===h&&(j.addClass("visuallyhidden"),i.addClass(c)),g.append(i)}f.prepend(g)}function n(){var a="bc-ontime";return D&&(a="bc-islate"),[e(),F+"<br /><small>"+G.substring(0,30)+"</small><br /><small>"+x+"</small><br /><small>"+L[7]+": "+B+" / "+z+": "+A+"</small><br /><small>"+L[4]+": "+y+"&nbsp; "+L[6]+': <span class="'+a+'">'+C+"</span></small><br />",H]}function o(){return a("#id_count").html(M()),!1}function p(){return a("#submit_count").html(N()),!1}function q(){I=document.getElementById("id_reverttodraft").checked===!0?"1":"0"}function r(){document.getElementById("id_reverttodraft").checked=!1}function s(){J=document.getElementById("id_submitontime").checked===!0?"1":"0"}function t(){document.getElementById("id_submitontime").checked=!1}var u,v,w,x,y,z,A,B,C,D,E="",F="-",G="",H="Not Submitted",I="0",J="0",K=0,L=[],M=function(){function a(){b+=1}var b=0;return function(){return a(),b}}(),N=function(){function a(){b+=1}var b=0;return function(){return a(),b}}();return{init:function(a,b){c(),u=a,v=b}}});